# Unit Test Workflow
# This workflow runs Jest unit tests to ensure code quality and functionality
# Documentation: https://jestjs.io/docs/getting-started
#
# Purpose: Automatically run unit tests on push and pull requests to catch
# bugs and regressions before they reach the main branch.
#
# Test Framework: Jest with jsdom environment for browser simulation
#
# How to add/run tests:
# - Add test files in the __tests__ directory with .test.js extension
# - Run locally: npm test (requires npm install first)
# - Run with coverage: npm run test:coverage
# - Run in watch mode: npm run test:watch
#
# Test file naming conventions:
# - __tests__/*.test.js
# - __tests__/*.spec.js
#
# Maintenance: Keep Jest updated via dependabot or manual updates in package.json

name: Unit Tests

permissions: {}

on:
  # Run on pull requests targeting any branch
  pull_request:

jobs:
  test:
    name: Run Unit Tests
    runs-on: ubuntu-latest

    permissions:
      contents: read

    strategy:
      matrix:
        # Test on multiple Node.js versions for compatibility
        node-version: [18.x, 20.x]

    steps:
      - name: Checkout Code
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
        with:
          persist-credentials: false

      - name: Setup Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@395ad3262231945c25e8478fd5baf05154b1d79f # v6.1.0
        with:
          node-version: ${{ matrix.node-version }}
          cache: "npm"

      - name: Install Dependencies
        run: npm ci

      - name: Run Tests
        run: npm test

      - name: Generate Coverage Report
        run: npm run test:coverage
        if: matrix.node-version == '20.x'

      - name: Upload Coverage Report
        uses: actions/upload-artifact@ef09cdac3e2d3e60d8ccadda691f4f1cec5035cb # v4.5.0
        if: matrix.node-version == '20.x'
        with:
          name: coverage-report
          path: coverage/
          retention-days: 30
