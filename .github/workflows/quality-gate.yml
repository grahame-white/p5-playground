# Quality Gate Workflow
# This workflow serves as a required status check that aggregates results from
# linting and unit testing workflows.
#
# Purpose: Provides a single quality gate that can be used as a branch
# protection rule requirement. This ensures that both code quality (linting)
# and functionality (unit tests) are verified before allowing merges.
#
# Usage: Configure this workflow as a required status check in your branch
# protection rules instead of requiring individual workflow checks.
#
# Benefits:
# - Single point of control for quality gates
# - Easier branch protection configuration
# - Clear signal of overall code quality status
#
# Maintenance: If workflow or job names change in super-linter.yml or unit-test.yml,
# update the corresponding check names in the steps below.

name: Quality Gate

permissions: {}

on:
  pull_request:

jobs:
  quality-gate:
    name: Quality Gate Check
    runs-on: ubuntu-latest

    permissions:
      actions: read

    steps:
      - name: Check Workflow Status
        run: echo "Quality gate check - waiting for required workflows"

      - name: Wait for Super-Linter
        uses: fountainhead/action-wait-for-check@fa2ffbe1c3ab1697b0f28296e4d67fc1be5c59ba # v1.2.0
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          checkName: "Lint Code Base"
          ref: ${{ github.event.pull_request.head.sha }}
          timeoutSeconds: 300

      - name: Wait for Unit Tests (Node 18.x)
        uses: fountainhead/action-wait-for-check@fa2ffbe1c3ab1697b0f28296e4d67fc1be5c59ba # v1.2.0
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          checkName: "Run Unit Tests (18.x)"
          ref: ${{ github.event.pull_request.head.sha }}
          timeoutSeconds: 300

      - name: Wait for Unit Tests (Node 20.x)
        uses: fountainhead/action-wait-for-check@fa2ffbe1c3ab1697b0f28296e4d67fc1be5c59ba # v1.2.0
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          checkName: "Run Unit Tests (20.x)"
          ref: ${{ github.event.pull_request.head.sha }}
          timeoutSeconds: 300

      - name: Quality Gate Passed
        run: |
          echo "âœ… All quality gate checks passed!"
          echo "- Super-Linter: Passed"
          echo "- Unit Tests (Node 18.x): Passed"
          echo "- Unit Tests (Node 20.x): Passed"
